@{
    ViewData["Title"] = "Index";
}
<style>
        /*  Helper Styles */
    body {
        font-family: Varela Round;
        background: #f1f1f1;
    }

    a {
        text-decoration: none;
    }

    /* Card Styles */

    .card-sl {
        border-radius: 8px;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }

    .card-image img {
        max-height: 100%;
        max-width: 100%;
        border-radius: 8px 8px 0px 0;
    }

    .card-action {
        position: relative;
        float: right;
        margin-top: -25px;
        margin-right: 20px;
        z-index: 2;
        color: #E26D5C;
        background: #fff;
        border-radius: 100%;
        padding: 15px;
        font-size: 15px;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 1px 2px 0 rgba(0, 0, 0, 0.19);
    }

    .card-action:hover {
        color: #fff;
        background: #E26D5C;
        -webkit-animation: pulse 1.5s infinite;
    }

    .card-heading {
        font-size: 18px;
        font-weight: bold;
        background: #fff;
        padding: 10px 15px;
    }

    .card-text {
        padding: 10px 15px;
        background: #fff;
        font-size: 14px;
        color: #636262;
    }

    .card-button {
        display: flex;
        justify-content: center;
        padding: 10px 0;
        width: 100%;
        background-color: #1F487E;
        color: #fff;
        border-radius: 0 0 8px 8px;
    }

    .card-button:hover {
        text-decoration: none;
        background-color: #1D3461;
        color: #fff;

    }
</style>
<h1 style="text-align: center">Posts</h1>

<div id="postsdata">

</div>


@section scripts{
    <script>
        let pageNumber = 0;
        const pageSize = 5;

        function getHtmlTemplate(data){
            return `<div class="container" style="margin-top:50px;">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card-sl">
                            <div class="card-image">
                                <img
                                    src="https://images.pexels.com/photos/1149831/pexels-photo-1149831.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=650&w=940" />
                            </div>

                                            <a class="card-action" href="#"><img width="25px" src="https://www.iconpacks.net/icons/1/free-heart-icon-992-thumb.png"></a>
                            <div class="card-heading">
                                       ${data.num} Audi Q8
                            </div>
                            <div class="card-text">
                                Audi Q8 is a full-size luxury crossover SUV coupé made by Audi that was launched in 2018.
                            </div>
                            <div class="card-text">
                                $67,400
                            </div>
                            <a href="#" class="card-button"> Purchase</a>
                        </div>
                    </div>
                </div>  <br>`;
        }
       
        function displayNextSetOfPosts() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetPosts")",
                data: { limit: pageSize, start: pageNumber},
                success: function (data) 
                {
                    if (data.length > 0) 
                    {
                        data.forEach(function (number) 
                        {
                            let html = getHtmlTemplate(number);
                            $("#postsdata").append(html);
                            pageNumber++;
                        });
                    } else 
                    {
                        $(window).off("scroll", onScrollUpdate);
                    }
                },
                error: function (xhr, status, error) {
                    console.log(error);
                }
            });
        }

        function isScrollAtBottom() {
            return $(window).scrollTop() + $(window).height() === $(document).height();
        }

        function onScrollUpdate() {
            if (isScrollAtBottom()) {
                displayNextSetOfPosts();
            }
        }

        $(document).ready(function () {
            displayNextSetOfPosts();
            $(window).on("scroll", onScrollUpdate);
        });
    </script>
}

